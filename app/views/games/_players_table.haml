- voters    = players.voters
- observers = players.observers

%table.table
  %tr
    %th{:colspan => 4}
      Player Votes
  %tr
    %th{:align => :left}
      Player
    %th{:align => :left}
      Complexity
    %th{:align => :left}
      Amount of Work
    %th{:align => :left}
      Unknowns / Risks
    %th{:align => :left}
      Total Points
    %th.table-primary{:align => :left}
      Fibonacci Vote
    %th{:align => :left}
      voted?
    %th{:align => :left}
      Remove
  - voters.each do |player|
    %tr
      %td
        = player.name
      %td
        = show_player_votes ? player.complexity : 'x'
      %td
        = show_player_votes ? player.amount_of_work : 'x'
      %td
        = show_player_votes ? player.unknown_risk : 'x'
      %td
        = show_player_votes ? player.total_points : 'x'
      %td.table-primary
        = show_player_votes ? player.fibonacci_vote : 'x'
      %td
        = player.voted? ? 'Yes' : 'No'
      %td
        = link_to 'Remove', [player.game, player], data: { turbo_method: :delete, turbo_confirm: 'Are you sure?' }
  - if show_player_votes
    %tr
      %td
        Average
      %td
        #{as_average(voters.sum(:complexity), voters.players_voted.count)}
      %td
        #{as_average(voters.sum(:amount_of_work), voters.players_voted.count)}
      %td
        #{as_average(voters.sum(:unknown_risk), voters.players_voted.count)}
      %td
        #{as_average(voters.sum_total_points, voters.players_voted.count)}
      %td.table-primary
        #{as_average(voters.sum_fibonacci_vote, voters.players_voted.count)}
      %td

- if show_player_votes
  %table.table
    %tr
      %th{:colspan => 4}
        Summary
    %tr
      %th{:align => :left}
        Metric
      %th{:align => :left}
        Player
      %th{:align => :left}
        Points Total
      %th.table-primary{:align => :left}
        Fibonacci Vote
    %tr
      %td
        Highest
      %td
        #{voters.highest_voter.name}
      %td
        #{format_number(voters.highest_voter.total_points)}
      %td.table-danger
        #{format_number(voters.highest_voter.fibonacci_vote)}
    %tr
      %td
        Lowest
      %td
        #{voters.lowest_voter.name}
      %td
        #{format_number(voters.lowest_voter.total_points)}
      %td.table-success
        #{format_number(voters.lowest_voter.fibonacci_vote)}

- if observers.any?
  %table.table.mt-2
    %tr
      %th Observers
    - observers.each do |observer|
      %tr
        %td
          = observer.name
          %span.badge.bg-secondary.ms-1 Observer
        %td
          = link_to 'Remove', [observer.game, observer], method: :delete, :remote => true, data: { confirm: 'Are you sure?' }
